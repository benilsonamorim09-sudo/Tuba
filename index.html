<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUBAR√ÉO DELIVERY | Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .shark-bg { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .admin-section { display: none; }
    </style>
</head>
<body class="bg-slate-100 font-sans pb-24">

    <!-- Header -->
    <nav class="shark-bg text-white p-5 sticky top-0 z-50 shadow-2xl">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black italic tracking-tighter">ü¶à TUBAR√ÉO <span class="text-orange-500 underline">DELIVERY</span></h1>
            <div class="flex gap-4">
                <button onclick="toggleAdmin()" class="text-xs opacity-50">Painel ADM</button>
                <div class="relative">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-orange-500 text-[10px] px-1.5 rounded-full">0</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- √ÅREA ADMINISTRATIVA (Escondida por padr√£o) -->
    <section id="admin-panel" class="admin-section container mx-auto p-4 bg-white border-b-4 border-orange-500 mb-6">
        <h2 class="text-xl font-bold mb-4">Gerenciar Estoque</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <input id="prod-name" type="text" placeholder="Nome da Bebida" class="border p-2 rounded">
            <input id="prod-price" type="number" placeholder="Pre√ßo (R$)" class="border p-2 rounded">
            <input id="prod-img" type="text" placeholder="URL da Imagem" class="border p-2 rounded">
            <button onclick="addProduct()" class="bg-green-600 text-white font-bold p-2 rounded">ADICIONAR PRODUTO</button>
        </div>
        <div id="admin-list" class="space-y-2"></div>
    </section>

    <!-- √ÅREA DO CLIENTE -->
    <main class="container mx-auto p-4 mt-4">
        <div id="catalog" class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <!-- Produtos vir√£o do Supabase aqui -->
            <p class="text-center col-span-full opacity-50">Carregando estoque do Tubar√£o...</p>
        </div>
    </main>

    <!-- Barra de Finaliza√ß√£o -->
    <div id="footer-cart" class="fixed bottom-0 w-full bg-orange-600 p-4 text-white shadow-[0_-5px_20px_rgba(0,0,0,0.2)] hidden">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <p class="text-xs uppercase font-bold opacity-80">Total do Pedido</p>
                <p id="total-val" class="text-xl font-black">R$ 0,00</p>
            </div>
            <button onclick="fecharPedido()" class="bg-white text-orange-600 px-6 py-3 rounded-xl font-black flex items-center gap-2">
                <i class="fab fa-whatsapp"></i> FINALIZAR
            </button>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO SUPABASE (Suas credenciais inseridas aqui)
        const SB_URL = "https://qhnixcajsgusgfmnasmw.supabase.co";
        const SB_KEY = "sb_publishable_AE8P6axrNSSb9qGuyMF6hg_T7RkcBzm";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        let cart = [];

        // Inicializar
        async function init() {
            fetchProducts();
        }

        // --- FUN√á√ïES DO CLIENTE ---
        async function fetchProducts() {
            const { data, error } = await _supabase.from('products').select('*').order('created_at', { ascending: false });
            if (error) return console.error(error);

            const catalog = document.getElementById('catalog');
            const adminList = document.getElementById('admin-list');
            catalog.innerHTML = '';
            adminList.innerHTML = '';

            data.forEach(p => {
                // Card do Cliente
                catalog.innerHTML += `
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <img src="${p.image_url}" class="w-full h-32 object-cover">
                        <div class="p-3">
                            <h3 class="font-bold text-slate-800 text-sm h-10 overflow-hidden">${p.name}</h3>
                            <p class="text-orange-600 font-black text-lg">R$ ${Number(p.price).toFixed(2)}</p>
                            <button onclick="addToCart('${p.name}', ${p.price})" class="w-full mt-2 bg-slate-900 text-white py-2 rounded-lg text-xs font-bold uppercase tracking-tighter hover:bg-orange-500 transition-colors">Adicionar</button>
                        </div>
                    </div>
                `;
                // Lista do Admin
                adminList.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-50 p-2 text-sm border-l-4 border-orange-500">
                        <span>${p.name} - R$ ${p.price}</span>
                        <button onclick="deleteProduct('${p.id}')" class="text-red-500 font-bold">Excluir</button>
                    </div>
                `;
            });
        }

        function addToCart(name, price) {
            cart.push({ name, price });
            updateUI();
        }

        function updateUI() {
            document.getElementById('cart-count').innerText = cart.length;
            const total = cart.reduce((acc, cur) => acc + Number(cur.price), 0);
            document.getElementById('total-val').innerText = `R$ ${total.toFixed(2)}`;
            
            const footer = document.getElementById('footer-cart');
            cart.length > 0 ? footer.classList.remove('hidden') : footer.classList.add('hidden');
        }

        function fecharPedido() {
            if (!navigator.geolocation) return alert("Ative o GPS!");
            
            navigator.geolocation.getCurrentPosition((pos) => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                const total = document.getElementById('total-val').innerText;
                
                let texto = `ü¶à *PEDIDO TUBAR√ÉO DELIVERY*%0A%0A`;
                cart.forEach(i => texto += `‚Ä¢ ${i.name}%0A`);
                texto += `%0Aüí∞ *TOTAL:* ${total}`;
                texto += `%0Aüìç *MINHA LOCALIZA√á√ÉO:* https://www.google.com/maps?q=${lat},${lng}`;
                
                // TROQUE O N√öMERO ABAIXO PELO SEU (DDD + N√∫mero)
                window.open(`https://wa.me/5511999999999?text=${texto}`);
            });
        }

        // --- FUN√á√ïES DO ADMINISTRADOR ---
        function toggleAdmin() {
            const panel = document.getElementById('admin-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }

        async function addProduct() {
            const name = document.getElementById('prod-name').value;
            const price = document.getElementById('prod-price').value;
            const img = document.getElementById('prod-img').value;

            if(!name || !price) return alert("Preencha nome e pre√ßo!");

            const { error } = await _supabase.from('products').insert([{ name, price, image_url: img }]);
            if (error) alert("Erro ao salvar!");
            else {
                alert("ü¶à Produto na rede!");
                document.getElementById('prod-name').value = '';
                document.getElementById('prod-price').value = '';
                fetchProducts();
            }
        }

        async function deleteProduct(id) {
            if(!confirm("Deseja tirar este produto do card√°pio?")) return;
            await _supabase.from('products').delete().eq('id', id);
            fetchProducts();
        }

        init();
    </script>
</body>
</html>
